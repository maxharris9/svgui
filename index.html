<html>
  <head>
    <!-- <script src="https://cdn.jsdelivr.net/npm/preact/dist/preact.min.js"></script> -->
    <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="http://www.jimsproch.com/react/babel-browser.js"></script>
    <script crossorigin type="text/babel" src="./input.js"></script>
  </head>
  <body style="margin: 0; padding: 0;">
    <div id="root" />
    <script type="text/babel">
      const Button = (props) => {
        const textWidth = measureTextWidth({
          text: props.text,
          fontWeight: 500,
          fontStyle: 'regular',
          fontSize: '30px',
          fontFamily: 'sans-serif'
        })
        console.log(`measured text width: ${textWidth}`)

        return (
          <React.Fragment>
            <g transform={`translate(${props.x}, ${props.y})`}>
              <rect x={0} y={0} width={props.width} height={props.height} rx={15} ry={15} fill={props.fill} />
              <Center><Label text={props.text} x={props.width / 2} y={props.height / 2} width={textWidth * 3} height={21} fill={'white'} /></Center>
            </g>
          </React.Fragment>
        )
      }

      const Star = (props) => (
        <React.Fragment>
          {props.showLayout && <rect x={0} y={0} width={props.width} height={props.height} stroke={'orange'} fill={'none'} strokeDasharray={'5,5'} />}
          <g transform={`scale(${props.scale}, ${props.scale})`}>
            <polygon points={'90,0 30,188 180,68 0,68 150,188'} fill={'navy'} />
          </g>
        </React.Fragment>
      )

      const Label = (props) => {
        return (
          <React.Fragment>
            {props.showLayout && <rect x={props.x} y={props.y} width={props.width} height={props.height} stroke={'red'} fill={'none'} strokeDasharray={'5,5'} />}
            <text x={props.x} y={props.y + props.height} fill={props.fill} style={{ font: '30px sans-serif' }}>{props.text}</text>
          </React.Fragment>
        )
      }

      const translateKeyCode = (keyCode) => {
        switch (keyCode) {
          case 32: return ' '
          case 65: return 'a'
          case 66: return 'b'
          case 67: return 'c'
          case 68: return 'd'
          case 69: return 'e'
          case 70: return 'f'
          case 71: return 'g'
          case 72: return 'h'
          case 73: return 'i'
          case 74: return 'j'
          case 75: return 'k'
          case 76: return 'l'
          case 77: return 'm'
          case 78: return 'n'
          case 79: return 'o'
          case 80: return 'p'
          case 81: return 'q'
          case 82: return 'r'
          case 83: return 's'
          case 84: return 't'
          case 85: return 'u'
          case 86: return 'v'
          case 87: return 'w'
          case 88: return 'x'
          case 89: return 'y'
          case 90: return 'z'
          case 188: return ','
          case 190: return '.'
          case 191: return '/'
          default: {
            console.error(`TODO: add support for key code ${keyCode}`)
            return ''
          }
        }
      }

      const Focusable = (props) => {
        return (
          <a
            style={{ userSelect: 'none' }}
            xlinkHref={'#'}
            onFocus={(event) => console.log('focused')}
            onKeyUp={(event) => {
              props.onKeyUp({ charCode: translateKeyCode(event.keyCode), keyCode: event.keyCode })
            }}
          >
            {props.children}
          </a>
        )
      }

      const App = (props) => {
        const star = <Star width={90} height={94} scale={0.5}/>
        return (
          <React.Fragment>
            <InputController x={800} y={100} width={600} height={100} text={'Full Name'} showLayout={props.showLayout} />
            <InputController x={800} y={200} width={600} height={100} text={'Address'} showLayout={props.showLayout} />
            <InputController x={800} y={300} width={600} height={100} text={'City'} showLayout={props.showLayout} />
            <InputController x={800} y={400} width={600} height={100} text={'State'} showLayout={props.showLayout} />
            <InputController x={800} y={500} width={600} height={100} text={'ZIP Code'} showLayout={props.showLayout} />
            <Button x={800} y={600} width={600} height={100} text={'Sign Up'} fill={'teal'} showLayout={props.showLayout} />
          </React.Fragment>
        )
      }

      const Demo = (props) => {
        const star = <Star width={90} height={94} scale={0.5}/>
        return (
          <React.Fragment>
            <Button x={100} y={800} width={400} height={380} text={'App'} fill={'teal'} showLayout={props.showLayout} />
            <Input x={600} y={800} width={400} height={100} text={'This is an input element'} showLayout={props.showLayout} />
            <SpacedLine width={props.width} x={0} y={120} showLayout={props.showLayout} >
              <Center><Button width={120} height={120} text={'App'} fill={'red'}/></Center>
              <Center><Button width={120} height={120} text={'B'} fill={'goldenrod'}/></Center>
              <Center>{star}</Center>
              <Center><Button width={200} height={50} text={'Short Button'} fill={'orangered'}/></Center>
              <Center>{star}</Center>
              <Center>{star}</Center>
              <Center>{star}</Center>
              <Center>{star}</Center>
              <Center>{star}</Center>
            </SpacedLine>
            <Margin x={0} y={300} top={30} right={30} bottom={30} left={30} width={props.width} height={150}>
              <Button text={'Button Inside Margin'} fill={'purple'} />
            </Margin>

            <Margin x={0} y={500} top={47} right={100} bottom={47} left={100} width={props.width} height={94}>
              <SpacedLine>
                <Center>{star}</Center>
                <Center>{star}</Center>
                <Center>{star}</Center>
                <Center>{star}</Center>
                <Center>{star}</Center>
                <Center>{star}</Center>
                <Center>{star}</Center>
                <Center>{star}</Center>
              </SpacedLine>
            </Margin>

            {/* when no layout args are supplied, "inherit" from parent */}
            {/* TODO: when missing layout args and not inside layout container, console.error('layout props required - supply layout args or put ${componentName} into a layout container') */}
            {/* TODO: linear flow container that flows components in a text-like manner */}
            {/* TODO: scrolling container */}
          </React.Fragment>
        )
      }

      const Center = (props) => {
        const childWidth = props.children.props.width
        const childHeight = props.children.props.height

        const midX = -childWidth / 2
        const midY = -childHeight / 2

        return <g transform={`translate(${midX}, ${midY})`}>{props.children}</g>
      }

      const SpacedLine = (props) => {
        const slice = props.width / (props.children.length - 1)

        let result = []
        let currentPosition = 0
        for (let i = 0; i < props.children.length; i++) {
          result.push(currentPosition)
          currentPosition += slice
        }
        return (
          <g transform={`translate(${props.x}, ${0})`}>
            {props.showLayout && <line x1={0} y1={props.y} x2={props.width} y2={props.y} stroke={'green'} strokeDasharray={'5,5'} />}
            {
              result.map((pos, index) => {
                const child = props.children[index]
                return <g transform={`translate(${pos}, ${props.y})`} key={index}>{child}</g>
              })
            }
          </g>
        )
      }

      const Margin = (props) => {
        const innerX = props.x + props.left
        const innerY = props.y + props.top
        const innerWidth = props.width - props.left - props.right
        const innerHeight = props.height - props.top - props.bottom

        const innerProps = Object.assign({}, props.children.props, {
          x: innerX,
          y: innerY,
          width: innerWidth,
          height: innerHeight
        })

        const innerChildren = Object.assign({}, props.children, { props: innerProps })

        return (
          <React.Fragment>
            {
              props.showLayout && (
                <React.Fragment>
                  <rect
                    x={props.x}
                    y={props.y}
                    width={props.width}
                    height={props.height}
                    stroke={'red'}
                    strokeDasharray={'5,5'}
                    fill={'none'}
                  />
                  <rect
                    x={innerX}
                    y={innerY}
                    width={innerWidth}
                    height={innerHeight}
                    stroke={'brown'}
                    strokeDasharray={'5,5'}
                    fill={'none'}
                  />
                </React.Fragment>
              )
            }
            {
              innerChildren
            }
          </React.Fragment>
        )
      }

      class Root extends React.Component {
        constructor (props) {
          super(props)

          this.state = {
            width: this.getWindowWidth(),
            height: this.getWindowHeight()
          }
        }

        getWindowWidth () { return window.innerWidth * 2 }
        getWindowHeight () { return window.innerHeight * 2 }

        componentDidMount () {
          const onResize = (e) => {
            const height = this.getWindowHeight()
            const width = this.getWindowWidth()

            this.setState({ width, height })
          }
          window.addEventListener('resize', onResize)
        }

        render () {
          return (
            <React.Fragment>
              <svg viewBox={[0, 0, this.state.width, this.state.height]}>
                <rect x={0} y={0} width={this.state.width} height={this.state.height} fill={'cornsilk'} stroke={'red'} strokeWidth={2} strokeDasharray={'5,5'}/>
                <App width={this.state.width} height={this.state.height} showLayout />
              </svg>
            </React.Fragment>
          )
        }
      }

      const measureTextWidth = ({ text, fontWeight, fontStyle, fontSize, fontFamily }) => {
        const canvas = document.createElement('canvas')
        const ctx = canvas.getContext('2d')
        ctx.font = `${fontWeight} ${fontStyle} ${fontSize} ${fontFamily}`
        return ctx.measureText(text).width
      }

      ReactDOM.render(<Root />, document.getElementById('root'))
    </script>
  </body>
</html>
